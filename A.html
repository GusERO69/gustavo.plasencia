<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualización del camino A*</title>
    <style>
      .grid {
        display: grid;
        grid-template-columns: repeat(10, 50px);
        grid-auto-rows: 50px;
      }
      .cell {
        width: 50px;
        height: 50px;
        border: 1px solid black;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .path {
        background-color: red;
      }
    </style>
  </head>
  <body>
    <div id="container" class="grid"></div>

    <script>
      class Node {
        constructor(row, col, parent = null) {
          this.row = row;
          this.col = col;
          this.parent = parent;
          this.g = 0;
          this.h = 0;
          this.f = 0;
        }
      }

      function heuristic(node, goal) {
        return Math.abs(node.row - goal[0]) + Math.abs(node.col - goal[1]);
      }

      function getNeighbors(grid, node) {
        const neighbors = [];
        const directions = [
          [1, 0],
          [-1, 0],
          [0, 1],
          [0, -1],
        ];
        for (const dir of directions) {
          const row = node.row + dir[0];
          const col = node.col + dir[1];
          if (
            row >= 0 &&
            row < grid.length &&
            col >= 0 &&
            col < grid[0].length &&
            grid[row][col] !== 1
          ) {
            neighbors.push(new Node(row, col, node));
          }
        }
        return neighbors;
      }

      function astar(grid, start, goal) {
        const openSet = [start];
        const visited = new Set();

        while (openSet.length > 0) {
          openSet.sort((a, b) => a.f - b.f);
          const current = openSet.shift();

          if (current.row === goal[0] && current.col === goal[1]) {
            console.log("LLEGO AL OBJETIVO");
            const path = [];
            let node = current;
            while (node) {
              path.unshift([node.row, node.col]);
              node = node.parent;
            }
            return path;
          }

          visited.add(`${current.row},${current.col}`);

          for (const neighbor of getNeighbors(grid, current)) {
            const neighborKey = `${neighbor.row},${neighbor.col}`;
            if (visited.has(neighborKey)) continue;

            neighbor.g = current.g + 1;
            neighbor.h = heuristic(neighbor, goal);
            neighbor.f = neighbor.g + neighbor.h;

            openSet.push(neighbor);
          }
        }

        return null;
      }

      function drawGrid(grid, path) {
        const container = document.getElementById("container");
        container.innerHTML = "";

        for (let i = 0; i < grid.length; i++) {
          for (let j = 0; j < grid[i].length; j++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.textContent = grid[i][j];
            if (path && path.some(([row, col]) => row === i && col === j)) {
              cell.classList.add("path");
            }
            container.appendChild(cell);
          }
        }
      }

      const grid = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, 0, 0, 0, 1, 0, 0],
        [0, 0, 0, 1, 0, 0, 0, 1, 0, "B"],
        [1, 1, 1, 0, 0, 0, 0, 1, 0, 0],
        [0, 0, 0, 0, 1, 1, 1, 1, 0, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
        ["A", 0, 0, 0, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
      ];

      const start = new Node(7, 0);
      const goal = [3, 9];

      const path = astar(grid, start, goal);
      if (path) {
        console.log("El camino encontrado es:", path);
        drawGrid(grid, path);
      } else {
        console.log("No se encontró un camino válido.");
      }
    </script>
  </body>
</html>
